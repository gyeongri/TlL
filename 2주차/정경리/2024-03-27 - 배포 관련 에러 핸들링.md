##### 1. 백엔드 배포 에러 해결
---
**문제 1) .env 파일을 인식하지 못하는 문제**
	![](https://i.imgur.com/m2zZXe9.png)
	
* 백엔드 배포 시 Jenkins의 Credentials에 PW, 포트 번호 등등을 따로 빼둔 .env 파일을 Secret file로 등록하고, Jenkins 파이프라인에서 이 .env파일을 BE 디렉터리의 최상단으로 복사해오는 방식을 사용하는데, 해당 파일을 인식하지 못하여 환경변수가 적용되지 않고, ${SERVER_PORT}라고 읽히고 있는 것...

✔ 어떻게 해결했나?
* Dockerfile에 copy문을 사용하여 .env 파일을 도커 컨테이너 안으로도 복사해오도록 해야한다.


**문제2 ) SSL handshaking 에러**

1번의 에러를 해결하고 나니, 다른 문제가 생겼다.
==HTTP request parsing error...==
아무 요청도 보낸 적이 없는데 갑자기 이런 에러가 생겨서 하루종일 고통 받았다..
혹시 몰라서 certbot으로 발급받은 SSL 인증서에 문제가 있는지 살펴봤지만 인증서 만료기간은 5월까지로 넉넉했다.

```
![User]

2024-03-27T03:43:42.324Z INFO 1 --- [nio-3000-exec-1] o.apache.coyote.http11.Http11Processor : Error parsing HTTP request header Note: further occurrences of HTTP request parsing errors will be logged at DEBUG level. java.lang.IllegalArgumentException: Invalid character found in method name [0x160x030x010x000xee0x010x000x000xea0x030x03Z0xffw0xd70x1f&0x97lo0x930xbb0xa20xb40x910xc10x8e0x92b0xad0x1f0xa10xea0x070xdf00x1f0xd2s;t0xf70x9e ]. HTTP method names must be tokens at org.apache.coyote.http11.Http11InputBuffer.parseRequestLine(Http11InputBuffer.java:407) ~[tomcat-embed-core-10.1.19.jar!/:na] at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:264) ~[tomcat-embed-core-10.1.19.jar!/:na] at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.19.jar!/:na] at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896) ~[tomcat-embed-core-10.1.19.jar!/:na] at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744) ~[tomcat-embed-core-10.1.19.jar!/:na] at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.19.jar!/:na] at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191) ~[tomcat-embed-core-10.1.19.jar!/:na] at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659) ~[tomcat-embed-core-10.1.19.jar!/:na] at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.19.jar!/:na] at java.base/java.lang.Thread.run(Thread.java:840) ~[na:na]
```

nginx 쪽 에러 같아서 로그를 확인해보니...
==SSL handshake 에러==가 발생하고 있었고, index.html과 관련해서 redirection cycle이 발생하고 있었다. 프론트 빌드 실패로 html 파일이 없어서 생긴 문제인가 하고, 수동으로 파일을 넣어보았는데 단순 에러페이지를 직접 만든 에러 처리 페이지로 바꿀 수는 있었지만..ㅎ 해당 에러는 계속 발생하고 있었다.
![](https://i.imgur.com/gBuVjhi.png)

아래와 같은 에러가 엄청나게 많이 이어서 뜨고 있었다.
```
.248.44, server: j10d212.p.ssafy.io, request: "GET / HTTP/1.1", host: "3.38.162.203" 2024/03/27 00:26:25 [error] 33054#33054: *3230 rewrite or internal redirection cycle while internally redirecting to "/index.html", client: 135.125.217.54, server: j10d212.p.ssafy.io, request: "GET /.env HTTP/1.1", host: "3.38.162.203" 2024/03/27 00:26:25 [error] 33054#33054: *3231 rewrite or internal redirection cycle while internally redirecting to "/index.html", client: 135.125.217.54, server: j10d212.p.ssafy.io, request: "POST / HTTP/1.1", host: "3.38.162.203" 2024/03/27 00:27:38 [crit] 33054#33054: *3232 SSL_do_handshake() failed (SSL: error:14201044:SSL routines:tls_choose_sigalg:internal error) while SSL handshaking, client: 97.107.136.52, server: 0.0.0.0:443 2024/03/27 00:47:38 [error] 33054#33054: *3235 rewrite or internal redirection cycle while internally redirecting to "/index.html", client: 145.40.93.93, server: j10d212.p.ssafy.io, request: "GET / HTTP/1.0"
```

```
2024/03/27 13:14:20 [error] 33054#33054: *8227 rewrite or internal redirection cycle while internally redirecting to "/index.html", client: 135.125.246.110, server: j10d212.p.ssafy.io, request: "GET /.env HTTP/1.1", host: "3.38.162.203" 2024/03/27 13:14:21 [error] 33054#33054: *8228 rewrite or internal redirection cycle while internally redirecting to "/index.html", client: 135.125.246.110, server: j10d212.p.ssafy.io, request: "POST / HTTP/1.1", host: "3.38.162.203" 2024/03/27 13:30:35 [error] 33054#33054: *8229 rewrite or internal redirection cycle while internally redirecting to "/index.html", client: 135.125.246.110, server: j10d212.p.ssafy.io, request: "GET /.env HTTP/1.1", host: "3.38.162.203" 2024/03/27 13:30:36 [error] 33054#33054: *8230 rewrite or internal redirection cycle while internally redirecting to "/index.html", client: 135.125.246.110, server: j10d212.p.ssafy.io, request: "POST / HTTP/1.1", host: "3.38.162.203" 2024/03/27 13:30:37 [error] 33054#33054: *8231 rewrite or internal redirection cycle while internally redirecting to "/index.html", client: 44.200.218.251, server: j10d212.p.ssafy.io, request: "GET /.git/config HTTP/1.1", host: "3.38.162.203" 2024/03/27 13:32:11 [error] 33054#33054: *8232 rewrite or internal redirection cycle while internally redirecting to "/index.html", client: 107.170.252.38, server: j10d212.p.ssafy.io, request: "GET /ReportServer HTTP/1.1", host: "3.38.162.203" 2024/03/27 13:38:33 [crit] 33054#33054: *8233 SSL_do_handshake() failed (SSL: error:14201044:SSL routines:tls_choose_sigalg:internal error) while SSL handshaking, client: 69.164.210.38, server: 0.0.0.0:443
```

검색을 거듭하며 여러 방법을 시도해 보았지만 다른건 다 효과가 없었고, 다음 방법으로 해결했다.
nginx conf 파일에 다음 한줄을 추가했다.
(참고자료)
https://blogingming.tistory.com/entry/TLS-10-%EC%9D%80-%EC%B7%A8%EC%95%BD%ED%95%98%EB%8B%A4

`ssl_protocols TLSv1.e TLSv1.2 TLSv1.1`
⇒ ==nginx에서 사용할 TLS 버전을 설정해준다.==
⇒ 정확한 이유는 모르지만 TLSv1.0은 보안에 취약하다고 한다. 아마 mqtt나...dotenv나..? 어떤건지 모르겠지만... 보안상 이유로 어디선가 이 버전을 사용하지 않도록 해놨든가.. 지원하지 않든가.. 하는게 아닐까 싶다. 이 버전을 빼고 다른 버전만 명시해주었다.

![](https://i.imgur.com/MYLrXpq.png)


에러가 없어지고 주의만 몇개 떴다^^
![](https://i.imgur.com/7Ir0XBZ.png)





##### 3. 프론트 빌드 에러 해결
---
며칠째 해결이 되지 않고 있었던 타입 스크립트 에러..!
분명 로그로는 타입스크립트 에러라고 하는데...
선언하고 사용하지 않은 변수 등...
프론트 쪽에서 내 컴퓨터에서는 잘 되는데..?하면서 왜 배포가 안되는지 이해를 못했다.
물론 해당 에러가 발생하는 건 맞는데, 빌드에는 문제가 없다는 것이었다...
![](https://i.imgur.com/cWu95ht.png)


결론부터 말하자면..
이건 프론트 쪽에서 npm run build를 해보지 않고 npm run dev로만 보이는 결과를 바로 develop에 push 했기 때문에 생기는 에러다..!

==**프론트에서 꼭 npm run build가 되는지 확인을 한 후에 배포 브랜치에 merge해야 한다.**==


프론트에서 모든 에러가 뜨지 않도록 처리한 이후에 다시 merge 하니까 깔끔하게 해결됐다..!


